\documentclass[dvipsnames]{article}

\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{cases}
\usepackage{enumitem}
\usepackage{float}
\usepackage[a4paper]{geometry}
\usepackage{graphicx}
\usepackage[hidelinks]{hyperref}
\usepackage{listings}
\usepackage{pgfplots}
\usepackage{pxfonts}
\usepackage{subcaption}
\usepackage{subfiles}
\usepackage{xcolor}

\theoremstyle{definition}
\newtheorem{definition}{Definizione}
\newtheorem{observation}{Osservazione}
\newtheorem{proposition}{Proposizione}
\newtheorem{theorem}{Teorema}

\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\lstdefinelanguage{ps}{
    morekeywords=[1]{function, true, def},
    morekeywords=[2]{set, while, for, return, if, else, &&},
    morekeywords=[3]{assert, swap, max, min, random, randomInt, randomFrom, push, pop},
    morecomment=[l]{//},
    sensitive=true
}
\lstset{
    backgroundcolor=\color{backcolour},
    keywordstyle=[1]\color{Blue},
    keywordstyle=[2]\color{DarkOrchid},
    keywordstyle=[3]\color{Blue},
    numberstyle=\scriptsize\color{darkgray},
    commentstyle=\color{ForestGreen},
    basicstyle=\ttfamily\small,
    numbers=left,
    numbersep=5pt,
    language=ps
}

\pgfplotsset{compat=1.18}
\pgfplotsset{colormap name=viridis}
\usetikzlibrary{external}
\tikzexternalize[prefix=cache/]

\newcommand{\makeaxis}[2]{
    \makebox[\textwidth]{
        \begin{minipage}{0.8\paperwidth}
            \tikzsetnextfilename{#2_scat}
            \begin{tikzpicture}
                \begin{axis} [
                        set layers,
                        title={#1 - scatter plot}
                    ]
                    \addplot+ [
                    scatter,
                    mesh,
                    empty line=jump,
                    mark=square*,
                    restrict expr to domain={{\thisrow{freq}}{1:{+inf}}},
                    scatter src={\thisrow{freq}/\thisrow{max_freq}}
                    ] table [x=n,y=value] {data/#2.scat.dat};

                    \addplot+ [
                        on layer=axis foreground,
                        mark=none,
                        error bars/y dir=both,
                        error bars/y explicit,
                        error bars/error mark=|,
                        error bars/error mark options={
                                mark size=3pt,
                            }
                    ] table [
                            x=n,
                            y=avg,
                            y error plus expr={\thisrow{p75}-\thisrow{avg}},
                            y error minus expr={\thisrow{avg}-\thisrow{p25}}
                        ] {data/#2.dat};
                \end{axis}
            \end{tikzpicture}
            \hfill
            \tikzsetnextfilename{#2_dist}
            \begin{tikzpicture}
                \begin{axis} [
                        set layers,
                        title={#1 - funzione di distribuzione},
                        cycle list name=color list
                    ]
                    \foreach \size in {1,2,...,100} {
                            \addplot+ [
                                restrict expr to domain={
                                        {\thisrow{size}-\size}{0:0}}
                            ] table [
                                    x=value,
                                    y=prob
                                ] {data/#2.dist.dat};
                        }%
                \end{axis}
            \end{tikzpicture}
        \end{minipage}
    }
}

\newcommand{\makefigure}[2]{
    \expandafter\makeaxis{Generatore esaustivo}{exh_gen_#2}
    \vskip\baselineskip
    \expandafter\makeaxis{Generatore esaustivo con flitro}{exh_filt_gen_#2}
    \vskip\baselineskip
    \expandafter\makeaxis{Generatore casuale con filtro}{rand_filt_gen_#2}
    \vskip\baselineskip
    \expandafter\makeaxis{Generatore a intervalli}{int_filt_gen_#2}
    \vskip\baselineskip
    \makebox[\textwidth]{
        \tikzsetnextfilename{color_bar}
        \pgfplotscolorbardrawstandalone[
            colorbar horizontal,
            point meta min=0,
            point meta max=100,
            colorbar style={
                    width=\textwidth,
                    xtick={0,100},
                    xticklabels={min, max}
                }
        ]
    }
}
